# Generating Hi-C heatmaps

## Background
Here is the [link](https://genomebiology.biomedcentral.com/articles/10.1186/s13059-017-1161-y) to a nice overview paper on Hi-C data visualiztion. We will use [Pretext]() for visualizytion (it's not listed in the overview paper but concept is similar for all heatmap visualization software).

## Running Pretext on galaxy

### step 1: mapping Hi-C reads to the **scaffolded** genome

This step is similar to the scaffolding preparations; we use [**Map with BWA-MEM2**](https://usegalaxy.eu/root?tool_id=toolshed.g2.bx.psu.edu/repos/iuc/bwa_mem2/bwa_mem2/2.2.1+galaxy0) to map the Hi-C Illumina reads (Forward (R1) and reverse (R2)) to the genome, but we use the **scaffolded genome generated by YaHS** as the reference genome. Then filter and merge the mapped reads using [**Filter and merge** chimeric reads from Arima Genomics](https://usegalaxy.eu/root?tool_id=toolshed.g2.bx.psu.edu/repos/iuc/bellerophon/bellerophon/1.0+galaxy0). The resulting SAM/BAM file is input for Pretext. 

**NB!!** You can also use the BAM file that you genereated on **before**-scaffolding fasta genome to see the heatmap. You can then compare heatmaps **before** and **after** scaffolding.


### step 2: run Pretext to generate the Hi-C heatmap
From Tools panel choose [**PretextMap converts SAM or BAM files into genome contact maps**](https://usegalaxy.eu/root?tool_id=toolshed.g2.bx.psu.edu/repos/iuc/pretext_map/pretext_map/0.1.8+galaxy2) with the following settings:

**Input dataset in SAM or BAM format**: Output of filter and merge

**Sort by**: Don't sort

**How to filter**: No filter

and `Run Tool`.

### step 3: run 
From Tools panel choose [**Pretext Snapshot** image generator for Pretext contact maps](https://usegalaxy.eu/root?tool_id=toolshed.g2.bx.psu.edu/repos/iuc/pretext_snapshot/pretext_snapshot/0.0.3+galaxy1) with the following settings:

**Input Pretext map file:** result of previous step (in **pretext** format)

Accept the defaults and `Run Tool`. This takes a minute and generates several PNG files. The last PNG file is the **full map** with all scaffolds. 

You can also download the **pretext** file and visualize it in [PretextView](https://github.com/wtsi-hpag/PretextView/releases). 
